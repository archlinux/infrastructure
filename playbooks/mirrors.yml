- name: Common playbook for mirrors
  hosts: mirrors
  remote_user: root
  roles:
    - { role: common }
    - { role: firewalld }
    - { role: wireguard }
    - { role: sshd }
    - { role: root_ssh }
    - { role: certbot }
    - { role: nginx }
    - { role: syncrepo, tags: ['nginx'] }
    - { role: syncdebug, when: mirror_debug_packages is not defined or mirror_debug_packages }
    - { role: syncriscv, when: riscv_mirror_domain is defined }
    - { role: archweb, when: archweb_mirrorcheck_locations is defined, archweb_site: false, archweb_services: false, archweb_mirrorcheck: true }
    - { role: prometheus_exporters }
    - { role: promtail }
    - { role: fail2ban }
    - { role: geo_dns, when: "'geo_mirrors' in group_names" }
